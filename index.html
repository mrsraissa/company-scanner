<!DOCTYPE html>
<html>
<head>
  <title>ğŸ“¦ Inventory Logger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/@zxing/browser@0.0.9/umd/index.min.js"></script>
</head>
<body style="font-family: Arial; text-align: center; padding: 20px;">
  <h2>ğŸ“¦ Inventory Check & Log</h2>

  <video id="preview" width="300" height="200" style="border:1px solid #ccc;"></video><br><br>

  <label>Scanned Barcode:</label><br>
  <input type="text" id="barcode" readonly style="width:250px; padding:8px; font-size:16px;"><br><br>

  <div id="extra-fields" style="display: none;">
    <label>User Name:</label><br>
    <input type="text" id="user" placeholder="Your name" style="width:250px; padding:8px;"><br><br>

    <label>Quantity:</label><br>
    <input type="number" id="quantity" placeholder="Quantity" style="width:250px; padding:8px;"><br><br>

    <button onclick="submitLog()">âœ… Submit</button>
  </div>

  <div id="output" style="margin-top:20px; color:green;"></div>

  <script>
    let codeReader;
    let controls;

    async function startScanner() {
      codeReader = new ZXingBrowser.BrowserMultiFormatReader();
      try {
        controls = await codeReader.decodeFromVideoDevice(null, 'preview', (result, error, control) => {
          if (result) {
            document.getElementById('barcode').value = result.text;
            document.getElementById('extra-fields').style.display = 'block';
            control.stop(); // Stop camera after successful scan
          }
        });
      } catch (e) {
        document.getElementById('output').innerText = 'ğŸš« Could not access the camera.';
        console.error(e);
      }
    }

    function submitLog() {
      const barcode = document.getElementById('barcode').value;
      const user = document.getElementById('user').value;
      const quantity = document.getElementById('quantity').value;

      if (!barcode || !user || !quantity) {
        document.getElementById('output').innerText = 'âš ï¸ Please fill in all fields.';
        return;
      }

      // Display log result
      document.getElementById('output').innerHTML = `
        âœ… Submitted:<br>ğŸ“¦ ${barcode}<br>ğŸ‘¤ ${user}<br>ğŸ“Š ${quantity}
      `;

      // Clear form
      document.getElementById('barcode').value = '';
      document.getElementById('user').value = '';
      document.getElementById('quantity').value = '';
      document.getElementById('extra-fields').style.display = 'none';

      // Restart camera
      if (controls) controls.stop();
      startScanner();
    }

    window.onload = () => startScanner();
  </script>
</body>
</html>
